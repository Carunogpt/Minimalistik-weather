<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã</title>
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            font-weight: 300;
            margin: 0;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #app {
            max-width: 900px;
            margin: 20px auto;
        }

        #favorites-container {
            display: none;
            margin-bottom: 30px;
        }

        #favorites-container h2 {
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 400;
            font-size: 1.1em;
            color: #888;
            margin: 0 0 15px 0;
        }

        #favorite-city-card {
            padding: 50px 40px;
            border-top: 2px solid;
            border-image: linear-gradient(to right, #fff, #333) 1;
        }

        #tabs-container {
            border-bottom: 1px solid #333;
            margin-bottom: 30px;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        #tabs-scroll {
            display: flex;
        }

        button.tab {
            background: none;
            border: none;
            color: #888;
            padding: 15px 25px;
            font-size: 0.9em;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: color 0.3s, border-color 0.3s;
            flex-shrink: 0;
        }

        button.tab:hover {
            color: #fff;
        }

        button.tab.active {
            color: #fff;
            border-bottom-color: #fff;
        }

        span.favorite-star {
            cursor: pointer;
            margin-right: 8px;
            color: #555;
            transition: color 0.3s;
            font-size: 1.2em;
        }

        span.favorite-star:hover {
            color: #ffcc00;
        }

        span.favorite-star.is-favorite {
            color: #ffcc00;
        }

        .weather-card {
            display: none;
            padding: 30px 20px;
            border: 1px solid #333;
        }

        .weather-card.active {
            display: block;
        }

        .weather-card .temp, #favorite-city-card .temp {
            font-size: 4em;
            font-weight: 200;
            margin: 0;
        }

        #favorite-city-card .temp {
            font-size: 5em;
        }

        .weather-card .weather-desc, #favorite-city-card .weather-desc {
            font-size: 1.5em;
            margin: 10px 0 25px 0;
            font-weight: 300;
            color: #ccc;
        }

        .weather-card .details, #favorite-city-card .details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .weather-card .detail-item, #favorite-city-card .detail-item {
            background: #111;
            padding: 15px;
            border-left: 2px solid #333;
        }

        .weather-card .detail-item span, #favorite-city-card .detail-item span {
            display: block;
            color: #888;
            font-size: 0.8em;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .weather-card .detail-item strong, #favorite-city-card .detail-item strong {
            font-size: 1.2em;
            font-weight: 300;
        }

        #controls {
            margin-top: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        #refresh-button {
            background: transparent;
            border: 1px solid #555;
            color: #888;
            padding: 10px 20px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 300;
            transition: background 0.3s, color 0.3s;
        }

        #refresh-button:hover {
            background: #fff;
            color: #000;
        }

        #loading-indicator {
            display: none;
            color: #888;
            font-weight: 300;
            animation: pulse 1.5s infinite;
        }

        #last-updated {
            color: #555;
            font-size: 0.9em;
            font-weight: 300;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        @media (max-width: 768px) {
            body { padding: 15px; }
            .weather-card .temp, #favorite-city-card .temp { font-size: 3em; }
            #favorite-city-card { padding: 30px 20px; }
            #favorite-city-card .temp { font-size: 4em; }
            #tabs-container {
                margin-left: -15px;
                margin-right: -15px;
                padding: 0 5px;
            }
            button.tab { padding: 15px; }
            .weather-card .details, #favorite-city-card .details {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>

    <div id="app">
        <div id="favorites-container">
            <h2>‚òÖ –ò–ó–ë–†–ê–ù–ù–û–ï</h2>
            <div id="favorite-city-card">
                <h1 class="temp">--¬∞</h1>
                <p class="weather-desc">...</p>
                <div class="details">
                    <div class="detail-item">
                        <span>–û—â—É—â–∞–µ—Ç—Å—è</span>
                        <strong class="apparent_temperature">--¬∞</strong>
                    </div>
                    <div class="detail-item">
                        <span>–í–ª–∞–∂–Ω–æ—Å—Ç—å</span>
                        <strong class="relative_humidity_2m">--%</strong>
                    </div>
                    <div class="detail-item">
                        <span>–í–µ—Ç–µ—Ä</span>
                        <strong class="wind_speed_10m">-- –º/—Å</strong>
                    </div>
                    <div class="detail-item">
                        <span>–î–∞–≤–ª–µ–Ω–∏–µ</span>
                        <strong class="surface_pressure">-- –º–º —Ä—Ç.—Å—Ç.</strong>
                    </div>
                </div>
            </div>
        </div>

        <div id="tabs-container">
            <div id="tabs-scroll"></div>
        </div>

        <div id="weather-cards-container"></div>

        <div id="controls">
            <button id="refresh-button">–û–±–Ω–æ–≤–∏—Ç—å</button>
            <span id="loading-indicator">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            <span id="last-updated"></span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const CITIES = {
                vladivostok: { name: "–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫", lat: 43.1056, lon: 131.8735 },
                khabarovsk: { name: "–•–∞–±–∞—Ä–æ–≤—Å–∫", lat: 48.4827, lon: 135.0838 },
                stockholm: { name: "–°—Ç–æ–∫–≥–æ–ª—å–º", lat: 59.3293, lon: 18.0686 },
                toronto: { name: "–¢–æ—Ä–æ–Ω—Ç–æ", lat: 43.6532, lon: -79.3832 }
            };
            const UPDATE_INTERVAL = 10 * 60 * 1000;

            const tabsScroll = document.getElementById('tabs-scroll');
            const cardsContainer = document.getElementById('weather-cards-container');
            const loadingIndicator = document.getElementById('loading-indicator');
            const lastUpdatedSpan = document.getElementById('last-updated');
            const refreshButton = document.getElementById('refresh-button');
            const favoritesContainer = document.getElementById('favorites-container');
            const favoriteCard = document.getElementById('favorite-city-card');

            let activeCityId = Object.keys(CITIES)[0];
            let favoriteCityId = localStorage.getItem('favoriteWeatherCity');

            function getWeatherDescription(code) {
                if (code === 0) return { desc: "–Ø—Å–Ω–æ–µ –Ω–µ–±–æ", icon: "‚òÄ" };
                if ([1, 2, 3].includes(code)) return { desc: "–û–±–ª–∞—á–Ω–æ", icon: "‚õÖ" };
                if ([45, 48].includes(code)) return { desc: "–¢—É–º–∞–Ω", icon: "üå´Ô∏è" };
                if (code >= 51 && code <= 55) return { desc: "–ú–æ—Ä–æ—Å—å", icon: "üåßÔ∏è" };
                if (code >= 61 && code <= 65) return { desc: "–î–æ–∂–¥—å", icon: "üåßÔ∏è" };
                if (code >= 71 && code <= 77) return { desc: "–°–Ω–µ–≥", icon: "‚ùÑÔ∏è" };
                if (code >= 80 && code <= 82) return { desc: "–õ–∏–≤–Ω–∏", icon: "üåßÔ∏è" };
                if ([85, 86].includes(code)) return { desc: "–°–Ω–µ–≥–æ–ø–∞–¥", icon: "‚ùÑÔ∏è" };
                if (code >= 95) return { desc: "–ì—Ä–æ–∑–∞", icon: "‚õàÔ∏è" };
                return { desc: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ", icon: "‚ùì" };
            }

            function pressureHPaToMmHg(hpa) {
                return (hpa * 0.75006).toFixed(0);
            }

            function renderWeatherCard(data, cardElement) {
                const { desc, icon } = getWeatherDescription(data.weather_code);
                cardElement.querySelector('.temp').textContent = `${Math.round(data.temperature_2m)}¬∞`;
                cardElement.querySelector('.weather-desc').textContent = `${icon} ${desc}`;
                cardElement.querySelector('.apparent_temperature').textContent = `${Math.round(data.apparent_temperature)}¬∞`;
                cardElement.querySelector('.relative_humidity_2m').textContent = `${data.relative_humidity_2m}%`;
                cardElement.querySelector('.wind_speed_10m').textContent = `${data.wind_speed_10m.toFixed(1)} –º/—Å`;
                cardElement.querySelector('.surface_pressure').textContent = `${pressureHPaToMmHg(data.surface_pressure)} –º–º —Ä—Ç.—Å—Ç.`;
            }

            async function fetchWeatherData(cityId, isFavorite = false) {
                if (!cityId || !CITIES[cityId]) return;
                
                loadingIndicator.style.display = 'inline';
                const { lat, lon } = CITIES[cityId];
                const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,surface_pressure&timezone=auto`;

                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();

                    if (isFavorite) {
                        renderWeatherCard(data.current, favoriteCard);
                        favoritesContainer.style.display = 'block';
                    } else {
                        const card = cardsContainer.querySelector(`.weather-card[data-city-id="${cityId}"]`);
                        if(card) renderWeatherCard(data.current, card);
                    }
                    
                    lastUpdatedSpan.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString()}`;
                } catch (error) {
                    console.error('Fetch error:', error);
                    lastUpdatedSpan.textContent = `–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è`;
                } finally {
                    loadingIndicator.style.display = 'none';
                }
            }

            function fetchAllWeatherData() {
                Object.keys(CITIES).forEach(cityId => fetchWeatherData(cityId));
                if (favoriteCityId) {
                    fetchWeatherData(favoriteCityId, true);
                }
            }

            function setActiveTab(cityId) {
                activeCityId = cityId;
                tabsScroll.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.cityId === cityId);
                });
                cardsContainer.querySelectorAll('.weather-card').forEach(card => {
                    card.classList.toggle('active', card.dataset.cityId === cityId);
                });
            }

            function updateFavoriteStars() {
                tabsScroll.querySelectorAll('.favorite-star').forEach(star => {
                    star.classList.toggle('is-favorite', star.dataset.cityId === favoriteCityId);
                    star.textContent = star.dataset.cityId === favoriteCityId ? '‚òÖ' : '‚òÜ';
                });
            }

            function setFavoriteCity(cityId) {
                if (favoriteCityId === cityId) {
                    favoriteCityId = null;
                    localStorage.removeItem('favoriteWeatherCity');
                    favoritesContainer.style.display = 'none';
                } else {
                    favoriteCityId = cityId;
                    localStorage.setItem('favoriteWeatherCity', cityId);
                    fetchWeatherData(cityId, true);
                }
                updateFavoriteStars();
            }

            function init() {
                Object.keys(CITIES).forEach(cityId => {
                    const city = CITIES[cityId];
                    
                    const tab = document.createElement('button');
                    tab.className = 'tab';
                    tab.dataset.cityId = cityId;
                    
                    const star = document.createElement('span');
                    star.className = 'favorite-star';
                    star.dataset.cityId = cityId;
                    star.textContent = '‚òÜ';
                    star.addEventListener('click', (e) => {
                        e.stopPropagation();
                        setFavoriteCity(cityId);
                    });
                    
                    tab.appendChild(star);
                    tab.appendChild(document.createTextNode(city.name));
                    
                    tab.addEventListener('click', () => setActiveTab(cityId));
                    tabsScroll.appendChild(tab);

                    const card = document.createElement('div');
                    card.className = 'weather-card';
                    card.dataset.cityId = cityId;
                    card.innerHTML = `
                        <h1 class="temp">--¬∞</h1>
                        <p class="weather-desc">...</p>
                        <div class="details">
                            <div class="detail-item">
                                <span>–û—â—É—â–∞–µ—Ç—Å—è</span>
                                <strong class="apparent_temperature">--¬∞</strong>
                            </div>
                            <div class="detail-item">
                                <span>–í–ª–∞–∂–Ω–æ—Å—Ç—å</span>
                                <strong class="relative_humidity_2m">--%</strong>
                            </div>
                            <div class="detail-item">
                                <span>–í–µ—Ç–µ—Ä</span>
                                <strong class="wind_speed_10m">-- –º/—Å</strong>
                            </div>
                            <div class="detail-item">
                                <span>–î–∞–≤–ª–µ–Ω–∏–µ</span>
                                <strong class="surface_pressure">-- –º–º —Ä—Ç.—Å—Ç.</strong>
                            </div>
                        </div>
                    `;
                    cardsContainer.appendChild(card);
                });

                setActiveTab(activeCityId);
                updateFavoriteStars();
                
                if (favoriteCityId) {
                    fetchWeatherData(favoriteCityId, true);
                }

                fetchAllWeatherData();
                setInterval(fetchAllWeatherData, UPDATE_INTERVAL);
                refreshButton.addEventListener('click', fetchAllWeatherData);
            }

            init();
        });
    </script>
</body>
</html>

